<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968">
<META name="GENERATOR" content="hevea 1.07">
<TITLE>
Architecture
</TITLE>
</HEAD>
<BODY >

<H2><A NAME="htoc106">7.1</A>&nbsp;&nbsp;Architecture</H2>

<H3>7.1.1&nbsp;&nbsp;File organization</H3>
Gnucap source files are organized into groups by the name prefix as follows:
<DL COMPACT=compact><DT>
<B>ap</B><DD> ``Argparse''. Generic parser and lexical analysis library.
<DT><B>bm</B><DD> Behavioral modeling.
<DT><B>c</B><DD> Commands.
<DT><B>d</B><DD> Devices and models.
<DT><B>e</B><DD> Device and model base classes. (``e'' comes from
 ``electrical'' and is retained because of inertia.)
<DT><B>io</B><DD> Input and output library, raw, generic.
<DT><B>l</B><DD> Library. General purpose functions and classes that do not
 fit elsewhere.
<DT><B>m</B><DD> Math library.
<DT><B>plot</B><DD> Obsolete plotting that should be replaced.
<DT><B>s</B><DD> Simulation engine.
<DT><B>u</B><DD> Utility functions and classes. Gnucap Specific.
</DL>
The files <TT>ap_*</TT>, <TT>io_*</TT>, <TT>l_*</TT>, <TT>m_*</TT> are not Gnucap
specific. Although they were created for Gnucap, they are public domain
and may be used by anyone for any purpose.<BR>
<BR>
The remaining files <TT>bm_*</TT>, <TT>c_*</TT>, <TT>d_*</TT>, <TT>e_*</TT>,
<TT>s_*</TT>, <TT>u_*</TT> are Gnucap specific, and reuse is subject to the
Gnu Public License.<BR>
<BR>
Some of the <TT>d_*</TT> files are automatically generated during
compilation. Do not change them, because your changes may be lost in
a recompile. For licensing and distribution legal purposes, these
files are considered to be ``object'' code, even though they are
readable C++.<BR>
<BR>
The files <TT>d_*.model</TT>, where present, contain the actual model
descriptions as input for <TT>modelgen</TT>, the model compiler.
These files are the source that is used to generate the corresponding
<TT>.cc</TT> and <TT>.h</TT> files. All changes should be done to the <TT>.model</TT> file. For GPL purposes, these files are considered to be
``source''.

<H3>7.1.2&nbsp;&nbsp;Building, Makefiles</H3>
Gnucap uses a 4 part Makefile, designed for simultaneous builds on
several systems. A true Makefile is built by selecting and catenating
the four pieces. A master Makefile switches to a subdirectory and
builds a specialized Makefile there.
<DL COMPACT=compact><DT>
<B>Make1</B><DD> The file list. Specific to this program.
<DT><B>Make2</B><DD> Compiler and system dependencies. Specific to the
 compiler. In some cases, hardware dependencies are here. There are
 several provided. Choose the one that matches your system.
<DT><B>Make3</B><DD> Basic ``make'' targets. Generic.
<DT><B>Make.depend</B><DD> List of dependencies.
</DL>

<H3>7.1.3&nbsp;&nbsp;Program flow</H3>
It all starts at ``<TT>main</TT>'', in <TT>main.cc</TT>. The function
``<TT>main</TT>'' has a loop that gets input and calls ``<TT>CMD::cmdproc</TT>'' to dispatch the command.<BR>
<BR>
Batch mode is done in ``<TT>process_cmd_line</TT>'', by using ``<TT>CMD::cmdproc</TT>'' to execute the commands ``<TT>get</TT>'' or ``<TT>&lt;</TT>''
which is passed to ``<TT>CMD::cmdproc</TT>'' as text.<BR>
<BR>
The function ``<TT>CMD::cmdproc</TT>'' dispatches the command to its
handler. The handlers are located in the ``<TT>CMD</TT>'' namespace, and
the ``<TT>c_*</TT>'' files.
<BR>
<BR>
</BODY>
</HTML>
